<html>

<head>
    <!-- Load the d3 library. -->
    <link href='https://fonts.googleapis.com/css?family=Archivo+Black|Archivo+Narrow' rel='stylesheet' type='text/css'>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lato:400i|Permanent+Marker" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style/style.css" media="all"/>
    <title>California Wildfires</title>

</head>

<body>
  <div class="container">
      <img src="images/header.png" alt="Header" style="width:100%;">
      <div class="box"></div>
      <div class="centered">California Wildfires<br>
        <h1>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed imperdiet ante. Donec porta a purus vitae consectetur. Nulla fermentum mi eget mauris sollicitudin, sed suscipit erat pretium. Vestibulum a augue ut est dignissim porta quis at ligula. Fusce quam orci, vulputate feugiat ex vel, elementum accumsan arcu. Ut sed dolor nibh. Vivamus in iaculis ex, a rhoncus nulla. Sed vitae malesuada lectus, in efficitur ex. Nullam eu sagittis eros, vitae consectetur purus. Ut convallis augue dolor, non fringilla massa faucibus a. Quisque dictum in mauris nec mattis. Proin eget urna at augue posuere maximus ut vitae mauris. Duis mattis mauris mi, et egestas enim ultricies vel. Pellentesque vitae orci libero.</h1>
      </div>
    </div>
    <div id="map">

    </div>
    <div id="map_heading">
        <div class="line" id="line1"></div>
        <div class="line" id="line2"></div>





      </div>
      <div id="subtitle"><h6>Over the Past ## Years</h6></div>
      <div id="map_description">

      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed imperdiet ante. Donec porta a purus vitae consectetur. Nulla fermentum mi eget mauris sollicitudin, sed suscipit erat pretium. Vestibulum a augue ut est dignissim porta quis at ligula. Fusce quam orci, vulputate feugiat ex vel, elementum accumsan arcu. Ut sed dolor nibh. Vivamus in iaculis ex, a rhoncus nulla. Sed vitae malesuada lectus, in efficitur ex. Nullam eu sagittis eros, vitae consectetur purus. Ut convallis augue dolor, non fringilla massa faucibus a. Quisque dictum in mauris nec mattis. Proin eget urna at augue posuere maximus ut vitae mauris. Duis mattis mauris mi, et egestas enim ultricies vel. Pellentesque vitae orci libero.
      </p>
      <!-- <svg id="map_svg" width="900" height="1000"></svg>  -->
    </div>

	<div style="text-align: center;">
		<div id="map_svg" style="width:900px;height:1000px;display:inline-block;"></div>
	</div>

    <script>

      var width = 900;
      var height = 1000;
      //console.log("Here!!");

      var  projection = d3.geo.mercator()
      .scale(3900)
      .center([-120, 36])
      .translate([width/3, height/1.5])
      ;
      //var projection = d3.geo.albersUsa() //works but tried another method above
      //  .scale(2500)
      //  .translate([1000, 360]);


      var path = d3.geo.path()
        .projection(projection);

      var svg = d3.select("#map_svg").append("svg")
        .attr("width", width)
        .attr("height", height);

      d3.queue()
        .defer(d3.json, ("datasets/CACounties.json"))
        .defer(d3.csv, ("datasets/Landslides.csv"))
        .await(callback);

        function callback(error, ca, csv) {
          showCA(ca);
          showLandSlide(csv);
        }
        //console.log(ca.objects.caCounties); //for navigating the data in the console




      //need to clean cvs
      // var parseRow = function(row) {
      //   return row;
      // }


      //get the data
      // d3.queue()
      //   .defer(d3.csv, "datasets/msdv5.csv", parseRow)
      //   .defer(d3.json, "us.json")
      //   .await(callback);

      //   function callback (error, rawData, rawMap) {
      //     console.log("Code in the call-back function is only executed when every data file loads.");

      //     states = topojson.feature(rawMap, rawMap.objects.states);
      //     records = rawData;
      //     causes = getCauses(records);

      //     console.log(records);
      //     console.log(states);
      //     console.log(causes);

      //     records.forEach(function(d){
      //       var array = [
      //         parseFloat(d.Longitude),
      //         parseFloat(d.Latitude),
      //         parseInt(d.Fatalities),
      //         parseInt(d["Total victims"]),
      //         d.Date
      //       ];
      //       coordinates.push(array);
      //     })

      //     coordinates.reverse();
      //     //add parameters if needed
      //     showMap();
      //     showSunburst();

      //   }

    function showCA(ca) {

      //console.log(ca.objects.caCounties); //for navigating the data in the console
      svg.append("path")
        .datum(topojson.feature(ca, ca.objects.subunits))
        .attr("class", "land")
        .attr("d", path);
      //bind feature data to the map
      svg.selectAll(".subunit")
          .data(topojson.feature(ca, ca.objects.subunits).features)
        .enter().append("path")
        .attr("class", function(d) { return "subunit " + d.properties.name; })
        .attr("d", path)
        .style("fill", function(d) {
          if (d.properties.name == "San Diego") {
              return "#00538d";
          }
          else if (d.properties.name == "San Bernadino") {
            return "#0287e5";
          }
          else if (d.properties.name == "Riverside") {
            return "#2997e4"
          }
          else if (d.properties.name == "Alpine" || d.properties.name == "Imperial") {
            return "#62beff";
          }
          else {
            return "#91cffa";
          }
        })
        .on("mouseover", function(d){ //tooltip
          div.transition()
            .duration(200)
            .style("opacity", .9);
          div.html(d.properties.fullName)
            .style("left", (d3.event.pageX) + 10 + "px")
            .style("top", (d3.event.pageY - 30) + "px");
        })
        .on("mouseout", function(d) {
          div.transition()
            .duration(500)
            .style("opacity", 0.0);
        });
      //exterior border
      svg.append("path")
        .datum(topojson.mesh(ca, ca.objects.subunits, function(a, b) { return a === b;}))
        .attr("d", path)
        .attr("class", "exterior-boundary");
      //tooltop declaration
      var div = d3.select("#map").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);




    }



    function showLandSlide(landslideData) {
		console.log("== showLandSlide ==", landslideData);

		landslideData.forEach(function(d) {
			// CSV column names
			//id,date,time,continent_code,country_name,country_code,state/province,population,city/town,distance,location_description,latitude,longitude,geolocatio
			//hazard_type,landslide_type,landslide_size,trigger,storm_name,injuries,fatalities,source_name,source_link

			// Only converts those numbers (integers or reals)
			d.population = +d.population;
			d.distance = +d.distance;
			d.latitude = +d.latitude;
			d.longitude = +d.longitude;
			d.landslide_size = +d.landslide_size;
			d.injuries = +d.injuries;
			d.fatalities = +d.fatalities;
		});

		var keyCounties = d3.nest()
		    .key(function(d) { return d["county"]; })  // .sortKeys(d3.ascending)
    	.entries(landslideData);

    	console.log("Parse based on county == ", keyCounties);

		keyCounties.forEach(function(county) {

      console.log(county.values.length);


		});


    }




    </script>

</body>

</html>
