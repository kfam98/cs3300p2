<html>

<head>
    <!-- Load the d3 library. -->
    <link href='https://fonts.googleapis.com/css?family=Archivo+Black|Archivo+Narrow' rel='stylesheet' type='text/css'>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lato:400i|Permanent+Marker" rel="stylesheet">
    <script src="//d3js.org/d3.v3.min.js"></script>
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Lato:400|Permanent+Marker" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style/style.css" media="all"/>
    <title>California Wildfires</title>

</head>

<body>
  <div class="header">
    <!-- <div class="line" id="line1"></div> -->
    <div class="title">
      <h1>CALIFORNIA WILDFIRES</h1>
      <span id="subtitle">AND <br/> LANDSLIDES</span>
    </div>
  </div>


  <div class="sections">
  <div class="section" id="about" style="background: url(images/header2.png);">

      <div class="about_description"><span class="section_title">THE STORY BEHIND WILDFIRES AND LANDSLIDES</span><br>
        <div class="line" id="line2"></div>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed imperdiet ante. Donec porta a purus vitae consectetur. Nulla fermentum mi eget mauris sollicitudin, sed suscipit erat pretium. Vestibulum a augue ut est dignissim porta quis at ligula. Fusce quam orci, vulputate feugiat ex vel, elementum accumsan arcu. Ut sed dolor nibh. Vivamus in iaculis ex, a rhoncus nulla. Sed vitae malesuada lectus, in efficitur ex. Nullam eu sagittis eros, vitae consectetur purus. Ut convallis augue dolor, non fringilla massa faucibus a. Quisque dictum in mauris nec mattis. Proin eget urna at augue posuere maximus ut vitae mauris. Duis mattis mauris mi, et egestas enim ultricies vel. Pellentesque vitae orci libero.</p>
      </div>
  </div>

  <div class="section"  id="map">
      <div class="map_description">
        <div class="map_description_bg"></div>
        <span id="map_title" class="section_title graph_title" >
        Wildfires and Landslides in California</span>
        <!-- <div class="line" id="line3"></div> -->
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed imperdiet ante. Donec porta a purus vitae consectetur. Nulla fermentum mi eget mauris sollicitudin, sed suscipit erat pretium. Vestibulum a augue ut est dignissim porta quis at ligula. Fusce quam orci, vulputate feugiat ex vel, elementum accumsan arcu. Ut sed dolor nibh. Vivamus in iaculis ex, a rhoncus nulla. Sed vitae malesuada lectus, in efficitur ex. Nullam eu sagittis eros, vitae consectetur purus. Ut convallis augue dolor, non fringilla massa faucibus a. Quisque dictum in mauris nec mattis. Proin eget urna at augue posuere maximus ut vitae mauris. Duis mattis mauris mi, et egestas enim ultricies vel. Pellentesque vitae orci libero.
        </p>

      </div>


      <!-- <svg id="map_svg" width="1100" height="800"></svg> -->

    </div>


      <!-- <svg id="map_svg" width="900" height="1000"></svg>  -->
  <div class="section"  id="graph">
    <div class="graph_description">
      <span class="section_title graph_title" >
      GRAPH</span>
      <!-- <div class="line" id="line4"></div> -->
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sed imperdiet ante. Donec porta a purus vitae consectetur. Nulla fermentum mi eget mauris sollicitudin, sed suscipit erat pretium. Vestibulum a augue ut est dignissim porta quis at ligula. Fusce quam orci, vulputate feugiat ex vel, elementum accumsan arcu. Ut sed dolor nibh. Vivamus in iaculis ex, a rhoncus nulla. Sed vitae malesuada lectus, in efficitur ex. Nullam eu sagittis eros, vitae consectetur purus. Ut convallis augue dolor, non fringilla massa faucibus a. Quisque dictum in mauris nec mattis. Proin eget urna at augue posuere maximus ut vitae mauris. Duis mattis mauris mi, et egestas enim ultricies vel. Pellentesque vitae orci libero.
      </p>
    </div>



    <svg id="graph_svg" width="950" height="600"></svg>


  </div>

  <div class="footer">
  </div>


    <script>

      var width = 900;
      //console.log("Here!!");
      var height = 800;

      var projection = d3.geo.mercator()
      .scale(3000)
      .center([-120, 36])
      .translate([width/3.8, height/1.5]);

      var coordinates = [];
      //var projection = d3.geo.albersUsa() //works but tried another method above
      //  .scale(2500)
      //  .translate([1000, 360]);

      var rScale = d3.scaleSqrt()
        .domain([0.0, 1])
        .range([1, 3]);


      var path = d3.geo.path()
        .projection(projection);

      var svg = d3.select("#map").append("svg")

        .attr("width", width)
        .attr("height", height);
        // .attr("translate", "(-50, 0);");

      d3.queue()
        .defer(d3.json, ("datasets/CACounties.json"))
        .defer(d3.csv, ("datasets/Landslides.csv"))
        .defer(d3.csv, ("datasets/FiresToR.csv"))
        .await(callback);

        function callback(error, ca, landslide, fire) {
          showCA(ca);
          showLandSlide(landslide);
          showFire(fire);

        }




    function showCA(ca) {

      //console.log(ca.objects.caCounties); //for navigating the data in the console
      svg.append("path")
        .datum(topojson.feature(ca, ca.objects.subunits))
        .attr("class", "land")
        .attr("d", path);
      //bind feature data to the map
      svg.selectAll(".subunit")
          .data(topojson.feature(ca, ca.objects.subunits).features)
        .enter().append("path")
        .attr("class", function(d) { return "subunit " + d.properties.name; })
        .attr("d", path)
        .style("fill", function(d) {
          if (d.properties.name == "San Diego") {
              return "#30180d";
          }
          else if (d.properties.name == "San Bernadino") {
            return "#804124";
          }
          else if (d.properties.name == "Riverside") {
            return "#a0522d"
          }
          else if (d.properties.name == "Alpine" || d.properties.name == "Imperial") {
            return "#c69781";
          }
          else {
            return "#f7f7f7";
          }
        })
        .on("mouseover", function(d){ //tooltip
          div.transition()
            .duration(200)
            .style("opacity", .9);
          div.html(d.properties.fullName)
            .style("left", (d3.event.pageX) - 50 + "px")
            .style("top", (d3.event.pageY - 900) + "px");

        })
        .on("mouseout", function(d) {
          div.transition()
            .duration(500)
            .style("opacity", 0.0);
        });

      //exterior border
      svg.append("path")
        .datum(topojson.mesh(ca, ca.objects.subunits, function(a, b) { return a === b;}))
        .attr("d", path)
        .attr("stroke-opacity", 0.3)
        .attr("class", "exterior-boundary");
      //tooltop declaration
      var div = d3.select("#map").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);




    }


    function showFire(fireData) {




      fireData.forEach(function(d) {

  			d.FIRE_YEAR = +d.FIRE_YEAR;
  			d.LATITUDE = +d.LATITUDE;
  			d.LONGITUDE = +d.LONGITUDE;
  			d.FIRE_SIZE = +d.FIRE_SIZE;

        var array = [d.LONGITUDE, d.LATITUDE, d.FIRE_SIZE];
        coordinates.push(array);



  		});

      var circles = svg.selectAll("circle")
        .data(coordinates);


      circles.enter()
        .append("circle")
        .attr("r", function(d) {
          if ((d[2] > 1) && (d[2] <= 1000 )) { return 4; }
          else if ((d[2] > 1000) && (d[2] <= 10000 )) { return 9; }
          else if((d[2] > 10000)) {return 12;}

          // return rScale(d[3]);
          else {return rScale(d[2]);}
        })
        .merge(circles)
        .attr("cx", function(d) { return projection(d)[0]; })
        .attr("cy", function(d) { return projection(d)[1]; })
        .attr("fill", function(d) {
          if ((d[2] > 1) && (d[2] <= 1000 )) { return "#e9874f"; }
          else if ((d[2] > 1000) && (d[2] <= 10000 )) { return "#e9d44f"; }
          else if ((d[2] > 10000)) { return "#f2b593"; }
          // return rScale(d[3]);
          else {return "#E94F64";}
        });



    }



    function showLandSlide(landslideData) {
		console.log("== showLandSlide ==", landslideData);

		landslideData.forEach(function(d) {
			// CSV column names
			//id,date,time,continent_code,country_name,country_code,state/province,population,city/town,distance,location_description,latitude,longitude,geolocatio
			//hazard_type,landslide_type,landslide_size,trigger,storm_name,injuries,fatalities,source_name,source_link

			// Only converts those numbers (integers or reals)
			d.population = +d.population;
			d.distance = +d.distance;
			d.latitude = +d.latitude;
			d.longitude = +d.longitude;
			d.landslide_size = +d.landslide_size;
			d.injuries = +d.injuries;
			d.fatalities = +d.fatalities;
		});

		var keyCounties = d3.nest()
		    .key(function(d) { return d["county"]; })  // .sortKeys(d3.ascending)
    	.entries(landslideData);

    	console.log("Parse based on county == ", keyCounties);

		keyCounties.forEach(function(county) {

      console.log(county.values.length);


		});


    }




    </script>

</body>

</html>
